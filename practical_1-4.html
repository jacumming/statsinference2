<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Practical 1-4: Bayesian analysis of Poisson data</title>

<script src="site_libs/header-attrs-2.18/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Statistical Inference 2</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Term 1
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="practical_1-1.html">Practical 1 - Introduction to R</a>
    </li>
    <li>
      <a href="practical_1-2.html">Practical 2 - Sampling and Simulation</a>
    </li>
    <li>
      <a href="practical_1-3.html">Practical 3 - Likelihood Inference</a>
    </li>
    <li>
      <a href="practical_1-4.html">Practical 4 - Bayesian Inference</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Term 2
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="practical_2-1.html">Practical 1</a>
    </li>
    <li>
      <a href="practical_2-2.html">Practical 2</a>
    </li>
    <li>
      <a href="practical_2-3.html">Practical 3</a>
    </li>
    <li>
      <a href="practical_2-4.html">Practical 4</a>
    </li>
    <li>
      <a href="practical_2-5.html">Practical 5</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="install.html">
    <span class="fa fa-download"></span>
     
    Install
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-question-circle"></span>
     
    R Help
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="r_1_gettingstarted.html">1. Getting Started</a>
    </li>
    <li>
      <a href="r_2_variables.html">2. Variables</a>
    </li>
    <li>
      <a href="r_3_functions.html">3. Functions</a>
    </li>
    <li>
      <a href="r_4_vectors.html">4. Vectors</a>
    </li>
    <li>
      <a href="r_5_basicstats.html">5. Standard statistical functions</a>
    </li>
    <li>
      <a href="r_6_matrices.html">6. Matrices and data frames</a>
    </li>
    <li>
      <a href="r_7_plots.html">7. Plots</a>
    </li>
    <li>
      <a href="r_8_advplots.html">8. Advanced Plots</a>
    </li>
    <li>
      <a href="r_9_programming.html">9. Programming</a>
    </li>
    <li>
      <a href="r_10_statsmethods.html">10. Statistical methods</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="rstudio-ide.pdf">Cheatsheet: RStudio infterface</a>
    </li>
    <li>
      <a href="base-r.pdf">Cheatsheet: Base R</a>
    </li>
  </ul>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Practical 1-4: Bayesian analysis of Poisson
data</h1>

</div>


<p>In this practical we use R to investigate the conjugate Bayesian
analysis for Poisson data. We will also investigate using the effects of
the prior distribution on the posterior, and the situation where our
sample size grows large.</p>
<ul>
<li><a href="scripts/practical_1-4.R">Download the R Script</a> - right
click, and Save As</li>
</ul>

<div class="goals">
<ul>
<li>You will need the following skills from previous practicals:
<ul>
<li>Creating vectors with <code>seq</code></li>
<li>Drawing a plot of a known function using <code>curve</code></li>
<li>Using additional graphical parameters to customise plots with colour
(<code>col</code>), line type (<code>lty</code>), axis range
(<code>xlim</code> and <code>ylim</code>) etc</li>
<li>Adding simple straight lines to plots with <code>abline</code></li>
<li>Writing your own functions with <code>function</code></li>
</ul></li>
<li>New R techniques:
<ul>
<li>Using <code>plot</code> to draw plots of general data, and
<code>lines</code> and <code>point</code> to add additional data</li>
<li>Using R’s built-in functions to evaluate a standard pdf,
e.g. <code>dgamma</code> and <code>dnorm</code></li>
<li>Using the quantile functions, e.g. <code>qgamma</code>, to produce
exact credible intervals using standard distributions</li>
<li>Using <code>sapply</code> to evaluate a function with different
arguments specified by the element of a vector</li>
</ul></li>
</ul>
</div>
<div id="the-data" class="section level1" number="1">
<h1><span class="header-section-number">1</span> The Data</h1>
<p>Our dataset concerns the number of volcanoes that erupted each year
from 2000 to 2018, taken from <a
href="https://volcano.si.edu/faq/index.cfm?question=eruptionsbyyear">here</a>.
The data are given in the table below, where each volcanic eruption is
counted in the year that the eruption started. Volcanic eruptions are
split into groups depending on the severity of the eruption, as measured
on the logarithmically-scaled <em>Volcanic Explosivity Index</em> (VEI).
For example, the 2010 eruption of Eyjafjallajökull in Iceland had a VEI
of 4, whereas the eruption of Krakatoa in 1883 was VEI6.</p>
<p>The eruptions are loosely classified as <code>Small</code> (VEI<span
class="math inline">\(\leq 2\)</span>), <code>Medium</code> (<span
class="math inline">\(2&lt;\)</span> VEI <span
class="math inline">\(&lt;4\)</span>), and <code>Large</code> (VEI <span
class="math inline">\(\geq 4\)</span>).</p>
<table class="table table-striped" style="margin-left: auto; margin-right: auto;">
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;">
Year
</td>
<td style="text-align:right;">
2000
</td>
<td style="text-align:right;">
2001
</td>
<td style="text-align:right;">
2002
</td>
<td style="text-align:right;">
2003
</td>
<td style="text-align:right;">
2004
</td>
<td style="text-align:right;">
2005
</td>
<td style="text-align:right;">
2006
</td>
<td style="text-align:right;">
2007
</td>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
2009
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
Small
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
32
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
34
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
28
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
Medium
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
Large
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<table class="table table-striped" style="margin-left: auto; margin-right: auto;">
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;">
Year
</td>
<td style="text-align:right;">
2010
</td>
<td style="text-align:right;">
2011
</td>
<td style="text-align:right;">
2012
</td>
<td style="text-align:right;">
2013
</td>
<td style="text-align:right;">
2014
</td>
<td style="text-align:right;">
2015
</td>
<td style="text-align:right;">
2016
</td>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
2018
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
Small
</td>
<td style="text-align:right;">
39
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
41
</td>
<td style="text-align:right;">
26
</td>
<td style="text-align:right;">
37
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
34
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
Medium
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
Large
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>

<div class="question">
<ul>
<li>Run the <code>R</code> code below to input the data, and create a
new data frame called <code>volcano</code>, with columns
<code>Year</code>, <code>Small</code>, <code>Medium</code>, and
<code>Large</code>.
</div></li>
</ul>
<pre class="r"><code>volcano &lt;- data.frame(Year = 2000:2018, 
           Small = c(30, 25, 30, 32, 29, 29, 34, 29, 25, 28, 39, 30, 
                     40, 40, 41, 26, 37, 30, 34), 
           Medium = c(6, 6, 5, 5, 8, 4, 3, 3, 7, 2, 6, 6, 4, 7, 7, 
                      5, 4, 6, 4),
           Large = c(0, 0, 0, 2, 1, 1, 1, 3, 2, 1, 3, 0, 1, 0, 1, 
                     0, 2, 0, 1))</code></pre>

<div class="technique">
<p><strong>Plot, points, and lines</strong></p>
<p>The <code>plot</code> function produces a scatterplot of its two
arguments. Suppose we have saved our <span
class="math inline">\(x\)</span> coordinates in a vector <code>a</code>,
and our <span class="math inline">\(y\)</span> coordinates in a vector
<code>b</code>, then to draw a scatterplot of <span
class="math inline">\((x,y)\)</span> we type</p>
<p><code>plot(x=a, y=b)</code></p>
<p>If the argument labels <code>x</code> and <code>y</code> are not
supplied, <em>R</em> will assume the first argument is <code>x</code>
and the second is <code>y</code>. If only one vector of data is
supplied, this will be taken as the <span
class="math inline">\(y\)</span> value and will be plotted against the
integers <code>1:length(y)</code>, i.e. in the sequence in which they
appear in the data.</p>
<p>All of the standard plot functions can be customised by passing
additional arguments to the function. For instance, we can add a plot
title and axis labels by supplying optional arguments:</p>
<ul>
<li><code>type</code> - determines the type of plot to draw. Possible
types are:
<ul>
<li>“p” for <strong>p</strong>oints</li>
<li>“l” for <strong>l</strong>ines</li>
<li>“b” for <strong>b</strong>oth (points connected by lines)</li>
<li>“h” for <strong>h</strong>istogram-like vertical lines</li>
<li>“s” for <strong>s</strong>tep lines</li>
</ul></li>
<li><code>xlab</code>, <code>ylab</code> - provides a label for the
horizontal and vertical axes</li>
<li><code>xlim</code>, <code>ylim</code> - allows for specification of a
minimum and maximum value of the corresponding axis limits,
e.g. <code>xlim=c(0,10)</code> will set the horizontal axis limits to be
<span class="math inline">\([0,10]\)</span>.</li>
<li><code>col</code> - can be specified to <a
href="r_8_advplots.html#col">use colour</a> for drawing</li>
</ul>
<p>For example,</p>
<p><code>plot(x=-10:10,y=sin((-10:10)/(2*pi)), type="b", xlab='A', ylim=c(-1.5,1))</code></p>
<p><em>Note</em>: Once a plot has been drawn, it is not possible to
erase any features from it - we can only add extra lines or points to
it. So, if you make a mistake drawing your plot then you’ll need to
start over with a fresh one by calling <code>plot</code> again.</p>
<p>After creating a <code>plot</code>, we can <em>add</em> additional
points to the plot by calling the <code>points</code> function which
draws additional points at the specified <code>x</code> and
<code>y</code> values. Similarly, the <code>lines</code> function will
draw connected lines between its <code>x</code> and <code>y</code>
arguments.</p>
</div>

<div class="question">
<ul>
<li><code>plot</code> the number of <code>Small</code> eruptions against
the year using a vertical axis range (<code>ylim</code>) of <span
class="math inline">\([0,50]\)</span>.</li>
<li>Experiment with the plot <code>type</code>s to see how the different
plots represent the data.</li>
<li>Redraw the data as a <code>l</code>ine <code>plot</code>, and add
<code>lines</code> of different colours to the same plot for the other
two groups of eruptions.</li>
<li>Do you see any apparent relationship between time and number of
eruptions?
</div></li>
</ul>

<div class="question">
<ul>
<li>Now plot the <code>hist</code>ogram of the number of
<code>Medium</code> eruptions - does it look like it could follow a
Poisson distribution? How else could you quickly assess this?
</div></li>
</ul>
</div>
<div id="conjugate-analysis-with-the-gamma-poisson-model"
class="section level1" number="2">
<h1><span class="header-section-number">2</span> Conjugate analysis with
the Gamma-Poisson model</h1>
<div id="the-theory" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> The Theory</h2>
<p>A Poisson distribution is often used to model the counts of random
events occurring within a fixed period of time at some rate <span
class="math inline">\(\lambda\)</span>. For such a random variable <span
class="math inline">\(X\)</span> where <span
class="math inline">\(X\sim\text{Po}(\lambda)\)</span> , a Bayesian
analysis will require a prior distribution for the unknown Poisson
parameter <span class="math inline">\(\lambda\)</span>. We have seen
that the Gamma distribution provides a conjugate prior for this
particular problem. Therefore, if our data <span
class="math inline">\(X_1,\dots,X_n\)</span> are <span
class="math inline">\(\text{Po}(\lambda)\)</span>, and our prior
distribution for <span class="math inline">\(\lambda\)</span> is <span
class="math inline">\(\text{Ga}(a,b)\)</span>. Then the posterior
distribution for <span class="math inline">\(\lambda ~|~
X_1,\dots,X_n\)</span> is given by: <span class="math display">\[
    \lambda ~|~ X_1,\dots,X_n \sim \text{Ga}(a+T, b+n),
\]</span> where <span class="math inline">\(T=\sum_{i=1}^n X_i=
n\overline{X}\)</span>.</p>
</div>
<div id="the-prior" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> The prior</h2>
<p>First, let’s use the Gamma distribution to identify an appropriate
prior for our Poisson count data.</p>

<div class="technique">
<p><strong>Standard density functions in R</strong></p>
<p><code>R</code> provides built-in functions to evaluate the PDF of
standard distributions. The density function for a Gamma distribution
<span class="math inline">\(\text{Ga}(a,b)\)</span> is used as
follows</p>
<p><code>dgamma(x, shape=a, rate=b)</code></p>
<p>where <code>x</code> is the point (or vector of points) where we want
to evaluate the PDF, and <code>a</code> and <code>b</code> are the usual
Gamma parameter values.</p>
</div>

<div class="question">
<ul>
<li>Create a vector containing a <code>seq</code>uence of 500
equally-spaced values over the interval <span
class="math inline">\([0,10]\)</span>. Call this
<code>lambdavals</code>.</li>
<li>Evaluate the <span class="math inline">\(\text{Ga}(1,1)\)</span> pdf
at each of the values of <span class="math inline">\(\lambda\)</span> in
<code>lambdavals</code> using the gamma PDF <code>dgamma</code>.</li>
<li>Make a <code>plot</code> of the pdf against <span
class="math inline">\(\lambda\)</span> as a solid black line.
</div></li>
</ul>
<p>An expert vulcanologist believes that the unknown rate of
<code>Medium</code> eruptions, <span
class="math inline">\(\lambda\)</span>, is such that a range of <span
class="math inline">\([1,6]\)</span> would be plausible.</p>
<p><em>You may need to use a pen and paper to do some maths to answer
some of the following exercise!</em></p>

<div class="question">
<ul>
<li>Interpret the expert’s given interval as corresponding to a
statement of <span class="math inline">\(\mathbb{E}(\lambda) \pm
2\text{sd}(\lambda)\)</span>. Using this statement and the expert’s
interval given above, find the value of the mean (<span
class="math inline">\(\mathbb{E}(\lambda)\)</span>) and variance (<span
class="math inline">\(\mathbb{V}\text{ar}(\lambda)=\text{sd}(\lambda)^2\)</span>)
of the prior distribution for <span
class="math inline">\(\lambda\)</span>.</li>
<li>Equate the prior mean and variance you have just found to the
theoretical values for the expectation (<span
class="math inline">\(a/b\)</span>) and variance (<span
class="math inline">\(a/b^2\)</span>) of a Gamma pdf. Solve these two
equations to find the expert’s corresponding values of the parameters
<span class="math inline">\(a\)</span> and <span
class="math inline">\(b\)</span>.</li>
<li>Evaluate the expert’s prior pdf for <span
class="math inline">\(\lambda\)</span> at each of
<code>lambdavals</code>, and save it as <code>cnjPrior</code>.</li>
<li>For plotting purposes, we need to normalise the values of
<code>cnjPrior</code> so that they sum (integrate) to 1. Divide the
values of <code>cnjPrior</code> by the <code>sum</code> of the values in
<code>cnjPrior</code>, and replace <code>cnjPrior</code> by these
normalised values.</li>
<li>Produce a fresh plot of the expert’s prior pdf for <span
class="math inline">\(\lambda\)</span> as a solid red curve. Ensure your
vertical axis covers <span class="math inline">\([0,0.02]\)</span>.</li>
<li>Add a vertical red and dashed line (<code>abline</code> using the
<code>v</code> argument) at the location of the prior expectation for
<span class="math inline">\(\lambda\)</span>.
</div></li>
</ul>
<p><img src="practical_1-4_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>

<div class="technique">
<p><strong>Quantiles of standard densities</strong></p>
<p>In addition to built-in functions for PDFs of standard distributions,
<code>R</code> also provides the <em>quantile function</em> for a pdf.
The quantile function evaluates the inverse of the cumulative
distribution function, <span class="math inline">\(F_X^{-1}(u)\)</span>.
Given a probability value <span
class="math inline">\(u\in[0,1]\)</span>, the quantile function returns
the value <span class="math inline">\(x\)</span> of <span
class="math inline">\(X\)</span> for which <span
class="math inline">\(P[X\leq x]=u\)</span>, and so the quantile
functions are particularly useful for finding critical values of
distributions and for finding exact credible intervals.</p>
<p>The quantile function for a Gamma density <span
class="math inline">\(X\sim \text{Ga}(a,b)\)</span> is used as
follows</p>
<p><code>qgamma(alpha, shape=a, rate=b)</code></p>
<p>where <code>alpha</code> is the lower tail probability (or vector of
lower-tail probabilities) for which we want the corresponding value(s)
of <span class="math inline">\(X\)</span>, and <code>a</code> and
<code>b</code> are the usual Gamma parameter values.</p>
</div>

<div class="question">
<ul>
<li>Use the <code>qgamma</code> function to find a 95% equal-tailed
prior credible interval for <span class="math inline">\(\lambda\)</span>
using the expert’s prior distribution above. <em>Hint:</em> find the
values of <span class="math inline">\(\lambda\)</span> with lower and
upper tail probabilities of <span
class="math inline">\(2.5\%\)</span>.</li>
<li>How does this compare to the expert’s original interval?
</div></li>
</ul>
</div>
<div id="the-likelihood" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> The likelihood</h2>
<p>The next ingredient in the Bayesian calculation requires us to
capture the information contained in the data via the likelihood. In a
Bayesian context, the likelihood is the conditional distribution of the
data <span class="math inline">\(X_1,\dots, X_n\)</span> given the
parameter <span class="math inline">\(\lambda.\)</span></p>
<p>Let’s compute the likelihood given our data on <code>Medium</code>
volcanic eruptions, and add it to the plot.</p>

<div class="question">
<ul>
<li>Write a function <code>poisLike</code> that computes the Poisson
likelihood for the sample of <code>Medium</code> volcano eruptions. Your
function should:
<ul>
<li>Take one argument <code>lambda</code></li>
<li>Compute the Poisson probability for each data point in
<code>volcano$Medium</code> given the value of <code>lambda</code>.
<em>Hint</em>: the <code>dpois</code> function evaluates Poisson
probabilities for a vector of values <code>x</code> and parameter
<code>lambda</code>. Or you can use your own function from last
time.</li>
<li>Combine the probabilities to find the likelihood of the entire
sample, and <code>return</code> it.</li>
<li>If your function is working correctly, you should agree with the
output below.
</div></li>
</ul></li>
</ul>
<pre class="r"><code>poisLike(5)</code></pre>
<pre><code>## [1] 4.225604e-17</code></pre>

<div class="technique">
<p><strong>Using <code>sapply</code> to repeat calculations over a
vector</strong></p>
<p>We have seen previously that we can use the <code>replicate</code> to
repeatedly call a function with no arguments. For functions which do
take an argument, we often want to call that function at many different
values. To do this, we use <code>sapply</code> to apply a specified
function to every element of a vector as its argument, and then return a
vector formed from the results.</p>
<p><code>sapply(x, fun)</code></p>
<p>applies the function <code>fun</code> to every element of the vector
<code>x</code> it then returns a vector containing the values of
<code>fun(x[1])</code>, <code>fun(x[2])</code>, and so on. So, to
compute the square-root of the integers <span
class="math inline">\(1\)</span> to <span
class="math inline">\(10\)</span>, we would write</p>
<p><code>sapply(1:10, FUN=sqrt)</code></p>
<p>or alternatively</p>
<p>which applies the square root function to each of the integers 1 to
10.</p>
<p>There are other variations of <code>apply</code> which work with
matrices and other data structures, and we will see those in later
practicals.</p>
</div>

<div class="question">
<ul>
<li>Use <code>sapply</code> to evaluate the Poisson likelihood
(<code>poisLike</code>) for each of the values of <span
class="math inline">\(\lambda\)</span> in <code>lambdavals</code>. Save
this as <code>like</code>.</li>
<li>Normalise <code>like</code> so that its values sum to <span
class="math inline">\(1\)</span>.</li>
<li>Add the likelihood to your plot of the prior distribution as
connected blue <code>lines</code>.</li>
<li>Add the maximum likelihood estimate of <span
class="math inline">\(\lambda\)</span> as a vertical dashed blue
line.</li>
<li>Your plot should look like the one below
</div></li>
</ul>
<p><img src="practical_1-4_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
</div>
<div id="the-posterior" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> The posterior</h2>
We can apply Bayes rule directly, given the prior and likelihood, and
numerically compute the posterior density for all of the values of <span
class="math inline">\(\lambda\)</span>.
<div class="question">
<ul>
<li>Directly compute the posterior for <span
class="math inline">\(\lambda\)</span> by Bayes theorem, and save these
values as <code>postDirect</code>. Normalise the <code>postDirect</code>
so that it sums to <span class="math inline">\(1\)</span>.
<em>Hint:</em> <span class="math inline">\(\text{Posterior} \propto
\text{Likelihood} \times \text{Prior}\)</span>.</li>
<li>Add the posterior to your plot as a solid green curve.
</div></li>
</ul>
<p>However, we also know that we’re using the conjugate Gamma prior with
a Poisson likelihood, so our posterior distribution for <span
class="math inline">\(\lambda\)</span> will also be a Gamma with
parameter values as above. Let’s verify that this is the case, and add
the resulting density function to our plot.</p>

<div class="question">
<ul>
<li>Now use conjugacy to evaluate the conjugate Gamma posterior
distribution.
<ul>
<li>First find the posterior values of the Gamma parameters <span
class="math inline">\(a\)</span> and <span
class="math inline">\(b\)</span>, save these as <code>aPost</code> and
<code>bPost</code>.</li>
<li>Now use <code>dgamma</code> with the posterior parameter values to
evaluate the posterior Gamma density at each of <code>lambdavals</code>.
Save these values to <code>postConjugate</code> and normalise to sum to
<span class="math inline">\(1\)</span>.</li>
</ul></li>
<li>Draw the conjugate posterior on your plot as a dashed
<code>purple</code> curve.</li>
<li>What do you see? Do the results agree with each other? How has the
prior changed?</li>
<li>Add the posterior mean as a vertical green line.</li>
<li>What do you notice about the relationship between the posterior
mean, the prior mean, and the maximum likelihood estimate?
</div></li>
</ul>
<p><img src="practical_1-4_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>

<div class="question">
<ul>
<li>Use the exact Gamma posterior to find a 95% posterior credible
interval for <span class="math inline">\(\lambda\)</span>.</li>
<li>Compare the posterior interval with the prior interval you found
earlier. What has changed?
</div></li>
</ul>
</div>
</div>
<div
id="further-exercises-exploring-the-effects-of-prior-choice-and-sample-size"
class="section level1" number="3">
<h1><span class="header-section-number">3</span> Further Exercises:
Exploring the effects of prior choice and sample size</h1>
<div id="changing-the-prior-parameters" class="section level2"
number="3.1">
<h2><span class="header-section-number">3.1</span> Changing the prior
parameters</h2>
<p>To investigate how sensitive our results are to our choices for <span
class="math inline">\(a\)</span> and <span
class="math inline">\(b\)</span> in the prior Gamma distribution, we’re
going to want to repeat our previous calculations for different values
of the prior parameters. To make this easier, let’s wrap those
calculations and plots in a new function that finds and draws the Gamma
posterior for a given prior and data set:</p>

<div class="question">
<ul>
<li>Write a function called <code>gammaPoisson</code> which:
<ul>
<li>Takes four arguments: the prior Gamma parameters <code>a</code> and
<code>b</code>, and the summary statistics <code>T</code> and
<code>n</code>.</li>
<li>Computes the <span class="math inline">\(\text{Ga}(a,b)\)</span>
prior and the <span class="math inline">\(\text{Ga}(a+T,b+n)\)</span>
posterior over the sequence of values in <code>lambdavals</code>.</li>
<li>Plots the (normalised) prior and posterior Gamma distributions as
coloured curves on one plot.</li>
<li>Adds the MLE as a dashed vertical line.</li>
</ul></li>
<li>Check your function by evaluating it with the values of
<code>a</code>,<code>b</code>,<code>T</code>, and <code>n</code> we used
for the <code>Medium</code> volcano data above.
</div></li>
</ul>

<div class="question">
<ul>
<li>Investigate what happens as you change <code>a</code> and
<code>b</code>.
<ul>
<li>How does the shape of the prior change? What impact does this have
on the posterior distribution?</li>
<li>What happens for large values of <code>a</code> and <code>b</code>?
How does this affect your results?
</div></li>
</ul></li>
</ul>
</div>
<div id="updating-beliefs-with-large-samples" class="section level2"
number="3.2">
<h2><span class="header-section-number">3.2</span> Updating beliefs with
large samples</h2>
<p>In Lecture 26, we will see that show that as the sample size grows
large, the posterior distribution tends towards a Normal distribution
and the posterior distribution becomes progressively less affected by
the choice of prior distribution.</p>
<p>Let’s expand our data with the records of volcanic eruptions for the
entire 20th century. As records are slightly incomplete, only the counts
of <code>Large</code> eruptions over this period can be considered
trustworthy. For the entire 100 years, a total of 64 <code>Large</code>
(VEI<span class="math inline">\(\geq 4\)</span>) eruptions were
recorded</p>

<div class="question">
<ul>
<li>Combine the 20th century data with the data from 2000-2018 and
compute new summary statistics for the <code>Large</code> volcanic
eruptions from 1900-2018. Save these as <code>Tbig</code> and
<code>Nbig</code>.</li>
<li>Use a prior of <span
class="math inline">\(\lambda\sim\text{Ga}(2,2)\)</span>, and plot the
posterior given the combined data. What happens to the posterior?
</div></li>
</ul>
<p>The large sample of data is clearly very informative for <span
class="math inline">\(\lambda\)</span>, resulting in a posterior
distribution that is concentrated over a small range of possible <span
class="math inline">\(\lambda\)</span> values. Let’s refocus our plot on
that sub-interval:</p>

<div class="question">
<ul>
<li>By modifying your Gamma-Poisson function, redraw the same plot to
zoom in on the interval <span
class="math inline">\(\lambda\in[0.25,1.25]\)</span>. Hint: you’ll need
to set the <a href="r_8_advplots.html#xlim"><code>xlim</code></a>
argument to <code>plot</code> (or add it as an argument to your
function).</li>
<li>What do you notice about the shape of the Gamma posterior
distribution?
</div></li>
</ul>
<div id="theory-limiting-posterior-distribution" class="section level3"
number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Theory: Limiting
posterior distribution</h3>
<p>If we suppose that <span
class="math inline">\(X=(X_1,\dots,X_n)\)</span> are an i.i.d. sample of
size <span class="math inline">\(n\)</span> from a distribution with pdf
<span class="math inline">\(f(x~|~\theta)\)</span> where <span
class="math inline">\(X_i \perp X_j ~|~ \theta\)</span> and <span
class="math inline">\(f(x~|~\theta)\)</span> is twice differentiable,
then for <span class="math inline">\(n\)</span> ‘large enough’ the
posterior distribution for <span class="math inline">\(\theta ~|~
x\)</span> is approximately <span class="math display">\[
    f(\theta ~|~ x) \approx \text{N}\left(\widehat{\theta},
          \frac{1}{{I}\left(\widehat{\theta}\right)}\right),
    \]</span> where <span
class="math inline">\(\widehat{\theta}\)</span> is the MLE of the
parameter <span class="math inline">\(\theta\)</span>, and <span
class="math inline">\(\text{I}(\widehat{\theta})\)</span> is the
observed Fisher information for a sample of size 1.</p>
<p>For a Poisson distribution, we have:</p>
<ul>
<li><span class="math inline">\(\widehat{\lambda}=\frac{\sum_i
x_i}{n}\)</span></li>
<li><span
class="math inline">\(\mathcal{L}&#39;&#39;(\lambda)=-\frac{\sum_i
x_i}{\lambda^2}\)</span>.</li>
</ul>

<div class="question">
<ul>
<li>Using the results above, compute the mean and variance of the
limiting posterior distribution for the <code>Large</code> volcano
eruption data.</li>
<li>Using <code>dnorm</code>, evaluate the Normal approximation to the
posterior pdf for <span class="math inline">\(\lambda\)</span> over
<code>lambdavals</code>. Normalise it again to sum to one, and add it to
your plot using a thick dashed line.</li>
<li>Is the limiting normal distribution in agreement with the Gamma
posterior? If it differs, how does it differ and to what extent?</li>
<li>Do the values of the Gamma prior parameters <span
class="math inline">\(a\)</span> and <span
class="math inline">\(b\)</span> affect the quality of the
approximation?
</div></li>
</ul>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
